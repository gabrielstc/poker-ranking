generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

model Club {
  id          String       @id @default(cuid())
  name        String       @unique
  description String?
  logo        String?
  isActive    Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  slug        String       @unique
  supremaId   String?
  whatsapp    String?
  players     Player[]
  tournaments Tournament[]
  users       User[]

  @@map("clubs")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  role      UserRole @default(CLUB_ADMIN)
  clubId    String?
  club      Club?    @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@map("users")
}

model Player {
  id             String                    @id @default(cuid())
  name           String
  nickname       String
  email          String?
  phone          String?
  createdAt      DateTime                  @default(now())
  updatedAt      DateTime                  @updatedAt
  clubId         String
  club           Club                      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  participations TournamentParticipation[]

  @@unique([nickname, clubId])
  @@map("players")
}

model Tournament {
  id             String                    @id @default(cuid())
  name           String
  date           DateTime
  buyIn          Float?
  description    String?
  status         TournamentStatus          @default(UPCOMING)
  createdAt      DateTime                  @default(now())
  updatedAt      DateTime                  @updatedAt
  type           TournamentType            @default(EXPONENCIAL)
  clubId         String
  participations TournamentParticipation[]
  club           Club                      @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@map("tournaments")
}

model TournamentParticipation {
  id           String     @id @default(cuid())
  playerId     String
  tournamentId String
  position     Int?
  points       Float?
  prize        Float?
  eliminated   Boolean    @default(false)
  eliminatedAt DateTime?
  player       Player     @relation(fields: [playerId], references: [id], onDelete: Cascade)
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)

  @@unique([playerId, tournamentId])
  @@map("tournament_participations")
}

enum TournamentStatus {
  UPCOMING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TournamentType {
  FIXO
  EXPONENCIAL
  EXPONENCIAL_NEW
}

enum UserRole {
  SUPER_ADMIN
  CLUB_ADMIN
}
